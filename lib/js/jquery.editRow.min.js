(function(a){a._editRow={};a._editRow.helper={element:null,defaults:{target:"tr",ajaxTarget:"",exclude:[],idColumn:".id",startRow:1,types:{},typesRemove:{},typesGetData:{}},settings:{},selectedRow:null,init:function(c,b){this.element=c;this.settings=a.extend(this.defaults,b);if(this.settings.ajaxTarget===""){throw"Missing ajax target!"}this.addStyles();this.addListener()},showFields:function(d){var b=a(d),c;if(a._editRow.helper.selectedRow!==null){a._editRow.helper.hideFields()}b.children().not(this.settings.exclude.join(" ")).each(function(){var e=a(this);e.css("position","relative");if(typeof a._editRow.helper.settings.types[e.data("type")]!=="undefined"){a._editRow.helper.settings.types[e.data("type")](e)}else{if(e.data("values")){a._editRow.helper.addSelect(e)}else{a._editRow.helper.addInput(e)}}});c=a('<div class="rowOptions"></div>');c.append('<button class="check"></button>');c.append('<button class="close"></button>');c.children("button").css({margin:0,height:b.outerHeight()});c.children(".check").button({icons:{primary:"ui-icon-check"},text:false}).on("click",function(f){f.stopPropagation();a._editRow.helper.sendData(a(this).parents(a._editRow.helper.settings.target))});c.children(".close").button({icons:{primary:"ui-icon-close"},text:false}).on("click",function(f){f.stopPropagation();a._editRow.helper.hideFields()});c.css({position:"absolute",top:0,right:-80,padding:0});b.append(c)},hideFields:function(){var b=this.selectedRow;b.children().not(this.settings.exclude.join(" ")).each(function(){var c=a(this);if(typeof a._editRow.helper.settings.typesRemove[c.data("type")]!=="undefined"){a._editRow.helper.settings.typesRemove[c.data("type")](c)}else{c.children(":input").remove()}});b.children().removeAttr("style");b.children(".rowOptions").remove();b.click(function(){a(this).unbind("click");a._editRow.helper.showFields(this);a._editRow.helper.selectedRow=a(this)});a._editRow.helper.selectedRow=null},addStyles:function(){this.element.find(this.settings.target).each(function(b){if(b+1>=a._editRow.helper.settings.startRow){a(this).css({cursor:"pointer",position:"relative"})}})},addListener:function(){this.element.find(this.settings.target).each(function(b){if(b+1>=a._editRow.helper.settings.startRow){a(this).click(function(){a(this).unbind("click");a._editRow.helper.showFields(this);a._editRow.helper.selectedRow=a(this)})}})},sendData:function(c){var b=a(c),d={};d.id=b.children(this.settings.idColumn).text();b.children().not(this.settings.exclude.join(" ")).each(function(){var f=a(this),e;if(typeof a._editRow.helper.settings.typesGetData[f.data("type")]!=="undefined"){d=a._editRow.helper.settings.typesGetData[f.data("type")](f,d)}else{e=f.children(":input");if(e.is("select")){var g="";if(e.prop("multiple")){e.children("option:selected").each(function(){g+=a(this).text()+", "});g=g.substr(0,g.length-2)}else{g=e.children("option:selected").text()}d[e.attr("name")]={value:e.val(),title:g}}else{d[e.attr("name")]={value:e.val(),title:e.val()}}}});a.getJSON(this.settings.ajaxTarget,d,function(e){if(e.ok){a._editRow.helper.hideFields();a._editRow.helper.updateColumns(c,d)}})},addInput:function(d){var b=a(d),c,e="text",f=b.text();if(b.data("type")){e=b.data("type")}if(b.data("value")){f=b.data("value")}c=a("<input />");c.attr({type:e,value:f,name:b.attr("class")});c.css({width:b.width(),height:b.outerHeight()-6,position:"absolute",top:0,left:b.css("paddingLeft"),margin:0});b.append(c)},addSelect:function(f){var d=a(f),c,g=d.data("value")+"",e=g.split("-"),b=d.data("multiple")?true:false;c=a("<select />");c.attr({name:d.attr("class")});c.prop("multiple",b);c.css({width:d.width(),height:d.outerHeight(),position:"absolute",top:0,left:d.css("paddingLeft"),margin:0,size:b?4:1,zIndex:200});a.each(d.data("values"),function(h,j){var i=a("<option></option>");i.attr("value",h);i.text(j);i.css("height",d.outerHeight());if(a.inArray(h,e)!==-1){i.prop("selected",true)}c.append(i)});if(b){c.mouseenter(function(){c.data("height",c.height());c.height("auto")});c.mouseleave(function(){c.height(c.data("height"))})}d.append(c)},updateColumns:function(c,d){var b=a(c);a.each(d,function(e,f){b.children("."+e).text(f.title)})}};a.fn.editFields=function(b){a._editRow.helper.init(a(this),b)}})(jQuery);